<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Innioasis Firmware Downloader</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Light mode colors */
            --bg-primary: #ffffff;
            --bg-secondary: #f5f5f7;
            --bg-tertiary: #fafafa;
            --text-primary: #1d1d1f;
            --text-secondary: #86868b;
            --text-tertiary: #6e6e73;
            --accent-primary: #007aff;
            --accent-secondary: #5856d6;
            --accent-success: #34c759;
            --accent-warning: #ff9500;
            --accent-error: #ff3b30;
            --border-primary: #d2d2d7;
            --border-secondary: #e5e5e7;
            --shadow-primary: rgba(0, 0, 0, 0.1);
            --shadow-secondary: rgba(0, 0, 0, 0.05);
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        [data-theme="dark"] {
            /* Dark mode colors */
            --bg-primary: #000000;
            --bg-secondary: #1c1c1e;
            --bg-tertiary: #2c2c2e;
            --text-primary: #ffffff;
            --text-secondary: #98989d;
            --text-tertiary: #8e8e93;
            --accent-primary: #0a84ff;
            --accent-secondary: #5e5ce6;
            --accent-success: #30d158;
            --accent-warning: #ff9f0a;
            --accent-error: #ff453a;
            --border-primary: #38383a;
            --border-secondary: #48484a;
            --shadow-primary: rgba(0, 0, 0, 0.3);
            --shadow-secondary: rgba(0, 0, 0, 0.2);
            --gradient-primary: linear-gradient(135deg, #1c1c1e 0%, #2c2c2e 100%);
            --gradient-secondary: linear-gradient(135deg, #2c2c2e 0%, #3a3a3c 100%);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background: var(--bg-primary);
            min-height: 100vh;
            color: var(--text-primary);
            line-height: 1.6;
            transition: all 0.3s ease;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 15px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            position: relative;
        }

        .theme-toggle {
            position: absolute;
            top: 0;
            right: 0;
            background: var(--bg-secondary);
            border: 1px solid var(--border-primary);
            color: var(--text-primary);
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .theme-toggle:hover {
            background: var(--bg-tertiary);
            border-color: var(--accent-primary);
        }

        .theme-toggle .icon {
            font-size: 1.1rem;
        }

        .header-icon {
            width: 80px;
            height: 80px;
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            transition: transform 0.3s ease;
        }

        .header-icon:hover {
            transform: scale(1.05);
        }

        .header-text {
            flex: 1;
            min-width: 300px;
        }

        .header h1 {
            font-size: 2.2rem;
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1rem;
            opacity: 0.9;
        }

        .main-content {
            background: var(--bg-secondary);
            border-radius: 24px;
            padding: 30px;
            box-shadow: 0 8px 32px var(--shadow-primary);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-secondary);
        }

        .filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            padding: 25px;
            background: var(--bg-primary);
            border-radius: 20px;
            border: 1px solid var(--border-secondary);
            box-shadow: 0 4px 16px var(--shadow-secondary);
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
            font-size: 0.9rem;
            letter-spacing: -0.01em;
        }

        .filter-group select {
            padding: 12px 16px;
            border: 1px solid var(--border-primary);
            border-radius: 12px;
            font-size: 14px;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .filter-group select:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
        }

        .refresh-btn {
            background: var(--accent-primary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            align-self: end;
            font-size: 0.9rem;
            font-family: inherit;
            box-shadow: 0 4px 16px rgba(0, 122, 255, 0.3);
        }

        .refresh-btn:hover {
            transform: translateY(-2px);
        }

        .refresh-btn:active {
            transform: translateY(0);
        }

        .firmware-list {
            background: var(--bg-primary);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid var(--border-secondary);
            box-shadow: 0 4px 16px var(--shadow-secondary);
        }

        .firmware-list h3 {
            margin-bottom: 20px;
            color: var(--text-primary);
            font-size: 1.3rem;
            font-weight: 700;
            letter-spacing: -0.02em;
        }

        .firmware-item {
            background: white;
            border-radius: 12px;
            padding: 18px;
            margin-bottom: 12px;
            border: 1px solid #e9ecef;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .firmware-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border-color: #667eea;
        }

        .firmware-item.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #f8f9ff 0%, #f0f2ff 100%);
        }

        .firmware-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
        }

        .firmware-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            margin-bottom: 15px;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
        }

        .detail-label {
            font-size: 0.75rem;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .detail-value {
            font-weight: 600;
            color: #495057;
            font-size: 0.9rem;
        }

        .download-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
        }

        .download-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }

        .download-section {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .download-rom-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            font-size: 1rem;
        }

        .download-rom-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
        }

        .automatic-install-btn {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            font-size: 1rem;
        }

        .automatic-install-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(23, 162, 184, 0.3);
        }

        .status {
            text-align: center;
            padding: 18px;
            background: #e8f5e8;
            border-radius: 12px;
            margin-bottom: 18px;
            border: 1px solid #a8e6cf;
        }

        .status.error {
            background: #fadbd8;
            border-color: #f5b7b1;
            color: #c0392b;
        }

        .status.loading {
            background: #fef9e7;
            border-color: #f8c471;
            color: #d68910;
        }
        
        .token-status {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 15px;
            margin: 18px 0;
            text-align: center;
        }
        
        .token-info {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .token-label {
            font-weight: 600;
            color: #495057;
        }
        
        .token-count {
            background: #667eea;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.9em;
        }
        
        .token-status-text {
            color: #6c757d;
            font-size: 0.9em;
        }
        
        .token-refresh-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.8em;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        
        .token-refresh-btn:hover {
            background: #218838;
        }
        
        .token-details-btn {
            background: #17a2b8;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.8em;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        
        .token-details-btn:hover {
            background: #138496;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s ease;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .footer {
            text-align: center;
            margin-top: 30px;
            color: white;
            opacity: 0.8;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .footer a {
            color: white;
            text-decoration: none;
            transition: opacity 0.3s ease;
        }

        .footer a:hover {
            text-decoration: underline;
            opacity: 1;
        }

        /* Footer Ko-Fi Button Styling */
        .footer-ko-fi-btn {
            display: inline-block;
            background: linear-gradient(135deg, #29abe0 0%, #1f8bc3 100%);
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.85rem;
            transition: all 0.3s ease;
            box-shadow: 0 3px 12px rgba(41, 171, 224, 0.3);
            border: none;
            cursor: pointer;
        }

        .footer-ko-fi-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 18px rgba(41, 171, 224, 0.4);
            background: linear-gradient(135deg, #1f8bc3 0%, #1673a3 100%);
        }

        .footer-ko-fi-btn:active {
            transform: translateY(0);
        }

        /* CTA Banner */
        .cta-banner {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            padding: 12px 16px;
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            z-index: 1000;
            max-width: 240px;
            text-align: center;
            transition: all 0.4s ease;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            opacity: 1;
            transform: translateY(0);
        }

        .cta-banner.fade-out {
            opacity: 0;
            transform: translateY(20px);
            pointer-events: none;
        }

        .cta-banner:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(0,0,0,0.4);
        }

        .cta-banner h3 {
            margin: 0 0 6px 0;
            font-size: 1rem;
            font-weight: 700;
        }

        .cta-banner p {
            margin: 0 0 10px 0;
            font-size: 0.85rem;
            opacity: 0.9;
        }

        .cta-banner .cta-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 6px 14px;
            border-radius: 18px;
            text-decoration: none;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-block;
        }

        .cta-banner .cta-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
            transform: scale(1.05);
        }

        .cta-banner .close-btn {
            position: absolute;
            top: 6px;
            right: 10px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 11px;
            line-height: 1;
            transition: all 0.3s ease;
        }

        .cta-banner .close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Platform-specific dialog styles */
        .platform-dialog {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            z-index: 2000;
            max-width: 500px;
            width: 90%;
            text-align: center;
            display: none;
        }

        .platform-dialog.show {
            display: block;
        }

        .platform-dialog h3 {
            color: #e74c3c;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .platform-dialog p {
            margin-bottom: 20px;
            line-height: 1.6;
            color: #333;
        }

        .platform-dialog .btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 0 10px;
        }

        .platform-dialog .btn:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        .platform-dialog .btn-secondary {
            background: #6c757d;
        }

        .platform-dialog .btn-secondary:hover {
            background: #5a6268;
        }

        /* Platform Guides Grid */
        .platform-guides-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .platform-guide-btn {
            padding: 15px 10px;
            font-size: 0.9rem;
            min-height: 60px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .dialog-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1999;
            display: none;
        }

        .dialog-overlay.show {
            display: block;
        }

        /* Command box styles */
        .command-box {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-primary);
            border-radius: 12px;
            padding: 16px;
            margin: 15px 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
        }

        .command-box code {
            background: var(--bg-primary);
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid var(--border-secondary);
            font-size: 0.9rem;
            color: var(--text-primary);
            flex: 1;
            word-break: break-all;
        }

        .copy-btn {
            background: var(--accent-primary);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .copy-btn:hover {
            background: var(--accent-secondary);
            transform: translateY(-1px);
        }

        .copy-btn:active {
            transform: translateY(0);
        }

        @media (max-width: 768px) {
            .cta-banner {
                bottom: 10px;
                right: 10px;
                left: 10px;
                max-width: none;
                border-radius: 20px;
            }
            
            .container {
                padding: 10px;
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
            }
            
            .header-icon {
                width: 60px;
                height: 60px;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .filters {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .firmware-details {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.5rem;
            }
            
            .header p {
                font-size: 0.9rem;
            }
            
            .container {
                padding: 8px;
            }
            
            .main-content {
                padding: 15px;
            }
        }

        /* macOS Installation Steps */
        .mac-step {
            text-align: left;
            margin: 20px 0;
        }

        .step-content {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .step-content h4 {
            color: #667eea;
            margin: 0 0 15px 0;
            font-size: 1.2rem;
        }

        .step-content p {
            margin: 12px 0;
            line-height: 1.6;
        }

        .step-content ol {
            margin: 15px 0;
            padding-left: 20px;
        }

        .step-content li {
            margin: 8px 0;
            line-height: 1.5;
        }

        .step-actions {
            margin-top: 25px;
            text-align: center;
        }

        .step-actions .btn {
            margin: 0 10px;
        }

        .alternative-install {
            text-align: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #dee2e6;
        }

        .alternative-link {
            color: #6c757d;
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .alternative-link:hover {
            color: #495057;
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="mtkclient/gui/images/icon.png" alt="Innioasis Icon" class="header-icon">
            <div class="header-text">
                <h1>Innioasis Firmware Downloader</h1>
                <p>Download firmware releases directly from GitHub</p>
            </div>
        </div>

        <div class="main-content">
            <div class="filters">
                <div class="filter-group">
                    <label for="deviceType">Device Type</label>
                    <select id="deviceType">
                        <option value="">All Types</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="deviceModel">Device Model</label>
                    <select id="deviceModel">
                        <option value="">All Models</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="software">Software</label>
                    <select id="software">
                        <option value="">All Software</option>
                    </select>
                </div>
                
                <button class="refresh-btn" onclick="refreshData()">
                    🔄 Refresh
                </button>
            </div>
            
            <!-- Token Status Display -->
            <div id="tokenStatus" class="token-status" style="display: none;">
                <div class="token-info">
                    <span class="token-label">GitHub API Tokens:</span>
                    <span id="tokenCount" class="token-count">0</span>
                    <span class="token-status-text" id="tokenStatusText">Loading...</span>
                    <button id="refreshTokensBtn" class="token-refresh-btn" onclick="refreshTokens()" style="display: none;">
                        🔄 Refresh Tokens
                    </button>
                    <button id="showTokenDetailsBtn" class="token-details-btn" onclick="showTokenDetails()" style="display: none;">
                        📊 Token Details
                    </button>
                </div>
            </div>

            <div class="status" id="status">
                Ready to download firmware
            </div>

            <div class="firmware-list">
                <h3>Available Firmware</h3>
                <div id="firmwareContainer">
                    <p style="text-align: center; color: #6c757d;">Select filters and click refresh to load firmware</p>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>Created by <a href="https://github.com/team-slide" target="_blank">Team Slide</a> | 
               <a href="https://innioasis.app" target="_blank">Innioasis App</a> | 
               <a href="https://discord.gg/Timmkoo" target="_blank">Discord</a></p>
            <p style="margin-top: 15px;">
                <a href="https://ko-fi.com/teamslide" target="_blank" class="footer-ko-fi-btn">
                    ☕ Buy Us a Coffee
                </a>
            </p>
            <p style="margin-top: 10px; font-size: 0.9rem; opacity: 0.7;">🍪 Cookies not used by this site</p>
        </div>
    </div>

    <!-- CTA Banner -->
    <div class="cta-banner" id="ctaBanner">
        <button class="close-btn" onclick="closeCTABanner()">×</button>
        <h3>🚀 Get Innioasis Updater</h3>
        <p id="ctaDescription">Download the desktop app for your platform</p>
        <button onclick="downloadForPlatform()" class="cta-btn" id="ctaButton">Download</button>
    </div>

    <!-- Platform-specific dialogs -->
    <div class="dialog-overlay" id="dialogOverlay"></div>
    
    <!-- Windows Dialog -->
    <div class="platform-dialog" id="windowsDialog">
        <h3>🪟 Windows Installation</h3>
        <p>Download the Windows installer and follow the setup instructions. After installation, you'll need to install the MTK drivers for proper device communication.</p>
        <button class="btn" onclick="downloadWindows()">Download Windows Installer</button>
        <button class="btn btn-secondary" onclick="closeDialog()">Close</button>
    </div>

    <!-- macOS Dialog -->
    <div class="platform-dialog" id="macDialog">
        <h3>🍎 macOS Installation</h3>
        
        <!-- Step 1: Prerequisites -->
        <div class="mac-step" id="macStep1">
            <div class="step-content">
                <h4>Prerequisites</h4>
                <p>Before installing Innioasis Updater, you'll need <a href="https://github.com/Homebrew/brew/releases/latest" target="_blank" class="homebrew-link">Homebrew</a> package manager on your Mac.</p>
                <p>Homebrew helps manage dependencies and ensures everything works smoothly.</p>
                
                <div class="step-actions">
                    <button class="btn btn-primary" onclick="nextMacStep()">Next →</button>
                    <button class="btn btn-secondary" onclick="closeDialog()">Close</button>
                </div>
            </div>
        </div>
        
        <!-- Step 2: Download -->
        <div class="mac-step" id="macStep2" style="display: none;">
            <div class="step-content">
                <h4>Download Innioasis Updater</h4>
                <p>Click the button below to download the macOS app package (.dmg file):</p>
                <button class="btn btn-primary" onclick="downloadMacDMG()">📥 Download for Mac</button>
                
                <div class="step-actions">
                    <button class="btn btn-secondary" onclick="prevMacStep()">← Back</button>
                    <button class="btn btn-primary" onclick="nextMacStep()">Next →</button>
                </div>
            </div>
        </div>
        
        <!-- Step 3: Installation -->
        <div class="mac-step" id="macStep3" style="display: none;">
            <div class="step-content">
                <h4>Install & Run</h4>
                <p>After downloading:</p>
                <ol>
                    <li>Double-click the .dmg file</li>
                    <li>Drag the Innioasis Updater app to your Applications folder</li>
                    <li>Launch the app from Applications</li>
                </ol>
                
                <p><strong>Note:</strong> You may need to <a href="#" id="appleGuideLink" target="_blank" class="apple-guide-link">allow apps from unknown developers</a> in System Preferences.</p>
                
                <div class="step-actions">
                    <button class="btn btn-secondary" onclick="prevMacStep()">← Back</button>
                    <button class="btn btn-primary" onclick="closeDialog()">Finish</button>
                </div>
            </div>
        </div>
        
        <!-- Alternative Install Method Link -->
        <div class="alternative-install">
            <a href="#" onclick="showMacTerminalInstall(); return false;" class="alternative-link">
                🔧 Alternative Install Method (Terminal)
            </a>
        </div>
    </div>

    <!-- Linux Dialog -->
    <div class="platform-dialog" id="linuxDialog">
        <h3>🐧 Linux Installation</h3>
        <p>Ubuntu is recommended for the best experience, but other distributions should work as well. Follow the instructions in the new tab to set up the required dependencies.</p>
        <button class="btn" onclick="openLinuxInstructions()">Open Instructions</button>
        <button class="btn btn-secondary" onclick="closeDialog()">Close</button>
    </div>

    <!-- ChromeOS/FydeOS Dialog -->
    <div class="platform-dialog" id="chromeosDialog">
        <h3>🖥️ ChromeOS/FydeOS</h3>
        <p>You MAY be able to run Innioasis Updater in Linux mode, but we have not tested this configuration. Follow the Linux instructions in the new tab and try running it in your Linux environment.</p>
        <p><em>Note: This is experimental and may not work as expected.</em></p>
        <button class="btn" onclick="openLinuxInstructions()">View Linux Instructions</button>
        <button class="btn btn-secondary" onclick="closeDialog()">Close</button>
    </div>

    <!-- Windows ARM64 Dialog -->
    <div class="platform-dialog" id="windowsArmDialog">
        <h3>🪟 Windows ARM64</h3>
        <p>For Windows ARM64 users, more advanced users may be able to run the Linux version using Python, Libusb, android-platform-tools, USBIPD-win and WSLg. Ubuntu is recommended.</p>
        <button class="btn" onclick="openLinuxInstructions()">View Linux Instructions</button>
        <button class="btn btn-secondary" onclick="closeDialog()">Close</button>
    </div>

    <!-- Platform Guides Dialog -->
    <div class="platform-dialog" id="platformGuidesDialog">
        <h3>🌍 Platform Setup Guides</h3>
        <p>Choose your platform to view detailed setup instructions:</p>
        <div class="platform-guides-grid">
            <button class="btn platform-guide-btn" onclick="showDialog('windowsDialog')">🪟 Windows</button>
            <button class="btn platform-guide-btn" onclick="showDialog('macDialog')">🍎 macOS</button>
            <button class="btn platform-guide-btn" onclick="showDialog('linuxDialog')">🐧 Linux</button>
        </div>
        <button class="btn btn-secondary" onclick="closeDialog()">Close</button>
    </div>

    <script>
        // Global variables
        let packages = [];
        let currentFilters = {
            deviceType: '',
            deviceModel: '',
            software: ''
        };
        
        // GitHub API tokens management
        let githubTokens = [];
        let currentTokenIndex = 0;
        let tokenCallCounts = {};
        const TOKEN_RATE_LIMIT = 5000; // GitHub's rate limit per hour per token

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            setupEventListeners();
            detectUserOS();
            checkBannerPreference();
            
            // Add scroll listener for banner fade-out
            window.addEventListener('scroll', checkDownloadButtonVisibility);
            // Check initially
            checkDownloadButtonVisibility();
        });

        // Detect user's operating system and update CTA banner
        function detectUserOS() {
            const userAgent = navigator.userAgent;
            let os = 'Windows';
            let downloadText = 'Download for Windows';
            let isArm64 = false;
            
            if (userAgent.includes('Mac')) {
                os = 'macOS';
                downloadText = 'Setup on Mac';
            } else if (userAgent.includes('Linux')) {
                os = 'Linux';
                downloadText = 'Download for Linux';
            } else if (userAgent.includes('CrOS') || userAgent.includes('FydeOS')) {
                os = 'ChromeOS/FydeOS';
                downloadText = 'Linux Mode Setup';
            }
            
            // Check for Windows ARM64
            if (userAgent.includes('Windows') && (userAgent.includes('ARM64') || userAgent.includes('ARM'))) {
                isArm64 = true;
                downloadText = 'Download for Windows ARM64';
            }
            
            // Store platform info globally
            window.userPlatform = { os, isArm64 };
            
            // Update CTA banner text
            const ctaTitle = document.querySelector('#ctaBanner h3');
            const ctaDesc = document.querySelector('#ctaBanner p');
            const ctaBtn = document.querySelector('#ctaBanner .cta-btn');
            
            if (ctaTitle && ctaDesc && ctaBtn) {
                ctaTitle.textContent = `🚀 Get Innioasis Updater`;
                ctaDesc.textContent = `Download the desktop app for ${os}`;
                ctaBtn.textContent = downloadText;
            }
        }

        // Close CTA banner
        function closeCTABanner() {
            const banner = document.getElementById('ctaBanner');
            if (banner) {
                banner.style.display = 'none';
                // Store preference in localStorage
                localStorage.setItem('ctaBannerClosed', 'true');
            }
        }

        // Check if banner was previously closed
        function checkBannerPreference() {
            if (localStorage.getItem('ctaBannerClosed') === 'true') {
                const banner = document.getElementById('ctaBanner');
                if (banner) {
                    banner.style.display = 'none';
                }
            }
        }

        // Check if download button is visible and fade out banner
        function checkDownloadButtonVisibility() {
            const downloadBtn = document.querySelector('.download-btn');
            const banner = document.getElementById('ctaBanner');
            
            if (downloadBtn && banner) {
                const rect = downloadBtn.getBoundingClientRect();
                const isVisible = rect.top < window.innerHeight && rect.bottom > 0;
                
                if (isVisible) {
                    banner.classList.add('fade-out');
                } else {
                    banner.classList.remove('fade-out');
                }
            }
        }

        // Platform-specific download functions
        function downloadForPlatform() {
            const platform = window.userPlatform;
            
            if (platform.isArm64) {
                showDialog('windowsArmDialog');
            } else if (platform.os === 'Windows') {
                showDialog('windowsDialog');
            } else if (platform.os === 'macOS') {
                showDialog('macDialog');
            } else if (platform.os === 'Linux') {
                showDialog('linuxDialog');
            } else if (platform.os === 'ChromeOS/FydeOS') {
                showDialog('chromeosDialog');
            }
        }

        function downloadWindows() {
            // Download Windows installer
            const link = document.createElement('a');
            link.href = 'https://github.com/team-slide/Innioasis-Updater/releases/download/1.0.0/InnioasisUpdater-Windows.exe';
            link.download = 'InnioasisUpdater-Windows.exe';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // Show driver download popup
            setTimeout(() => {
                alert('🎉 Download started! After installation, please download the required drivers from drivers.innioasis.app for proper device communication.');
            }, 1000);
            
            closeDialog();
        }

        function openMacInstructions() {
            window.open('https://github.com/team-slide/Innioasis-Updater#manual-setup', '_blank');
        }

        function copyMacCommand() {
            const command = '/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/team-slide/Innioasis-Updater/main/run_mac.sh)"';
            
            if (navigator.clipboard && window.isSecureContext) {
                // Use modern clipboard API
                navigator.clipboard.writeText(command).then(() => {
                    showCopySuccess();
                }).catch(() => {
                    fallbackCopyTextToClipboard(command);
                });
            } else {
                // Fallback for older browsers
                fallbackCopyTextToClipboard(command);
            }
        }

        function fallbackCopyTextToClipboard(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                document.execCommand('copy');
                showCopySuccess();
            } catch (err) {
                console.error('Fallback: Oops, unable to copy', err);
            }
            
            document.body.removeChild(textArea);
        }

        function showCopySuccess() {
            const copyBtn = document.querySelector('.copy-btn');
            const originalText = copyBtn.textContent;
            copyBtn.textContent = '✅ Copied!';
            copyBtn.style.background = 'var(--accent-success)';
            
            setTimeout(() => {
                copyBtn.textContent = originalText;
                copyBtn.style.background = 'var(--accent-primary)';
            }, 2000);
        }

        function openLinuxInstructions() {
            window.open('https://github.com/team-slide/Innioasis-Updater#linux---ubuntu-recommended', '_blank');
        }

        function showDialog(dialogId) {
            document.getElementById('dialogOverlay').classList.add('show');
            document.getElementById(dialogId).classList.add('show');
            
            // Update Apple guide link if showing macOS dialog
            if (dialogId === 'macDialog') {
                updateAppleGuideLink();
            }
        }

        function closeDialog() {
            document.getElementById('dialogOverlay').classList.remove('show');
            document.querySelectorAll('.platform-dialog').forEach(dialog => {
                dialog.classList.remove('show');
            });
        }

        // Close dialog when clicking overlay
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('dialogOverlay').addEventListener('click', closeDialog);
        });

        function setupEventListeners() {
            document.getElementById('deviceType').addEventListener('change', filterFirmware);
            document.getElementById('deviceModel').addEventListener('change', filterFirmware);
            document.getElementById('software').addEventListener('change', filterFirmware);
        }

        async function loadData() {
            try {
                setStatus('Loading configuration and manifest data...', 'loading');
                
                // Load GitHub API tokens first
                await loadGitHubTokens();
                
                // Load manifest data
                const manifestResponse = await fetch('https://raw.githubusercontent.com/team-slide/slidia/refs/heads/main/slidia_manifest.xml');
                if (!manifestResponse.ok) {
                    throw new Error('Failed to load manifest');
                }
                
                const manifestText = await manifestResponse.text();
                packages = parseManifest(manifestText);
                
                if (packages.length === 0) {
                    throw new Error('No packages found in manifest');
                }
                
                console.log(`Loaded ${packages.length} software packages`);
                
                // Populate filters
                populateDeviceTypeCombo();
                populateDeviceModelCombo();
                populateSoftwareCombo();
                
                // Load initial firmware list
                await loadFirmwareList();
                
                setStatus('Ready to download firmware');
                
            } catch (error) {
                console.error('Error loading data:', error);
                setStatus(`Error loading data: ${error.message}`, 'error');
            }
        }

        async function loadGitHubTokens() {
            try {
                setStatus('Loading GitHub API tokens...', 'loading');
                
                // Load tokens from the config file
                const configResponse = await fetch('https://raw.githubusercontent.com/team-slide/y1-helper/main/config.ini');
                if (!configResponse.ok) {
                    throw new Error('Failed to load config file');
                }
                
                const configText = await configResponse.text();
                const tokens = parseConfigTokens(configText);
                
                if (tokens.length === 0) {
                    console.warn('No GitHub API tokens found in config file');
                    setStatus('Warning: No GitHub API tokens available - using unauthenticated requests');
                    updateTokenStatus(0, 'No tokens available - using unauthenticated requests');
                } else {
                    console.log(`Loaded ${tokens.length} GitHub API tokens`);
                    setStatus(`Loaded ${tokens.length} GitHub API tokens`);
                    updateTokenStatus(tokens.length, `${tokens.length} tokens loaded successfully`);
                }
                
                githubTokens = tokens;
                
                // Initialize token call counts
                tokens.forEach(token => {
                    tokenCallCounts[token] = 0;
                });
                
            } catch (error) {
                console.warn('Failed to load GitHub tokens:', error);
                setStatus('Warning: Using unauthenticated GitHub API requests');
                updateTokenStatus(0, 'Failed to load tokens - using unauthenticated requests');
                githubTokens = [];
            }
        }
        
        function parseConfigTokens(configText) {
            const tokens = [];
            const lines = configText.split('\n');
            
            for (const line of lines) {
                const trimmedLine = line.trim();
                
                // Parse key_1, key_2, etc. entries
                if (trimmedLine.startsWith('key_') && trimmedLine.includes('=')) {
                    const [key, value] = trimmedLine.split('=').map(s => s.trim());
                    if (value && value !== '') {
                        // Add github_pat_ prefix if not present
                        const token = value.startsWith('github_pat_') ? value : `github_pat_${value}`;
                        tokens.push(token);
                    }
                }
                
                // Parse token = entry
                if (trimmedLine.startsWith('token = ')) {
                    const value = trimmedLine.substring(8).trim();
                    if (value && value !== '') {
                        // Add github_pat_ prefix if not present
                        const token = value.startsWith('github_pat_') ? value : `github_pat_${value}`;
                        tokens.push(token);
                    }
                }
            }
            
            return tokens;
        }
        
        function getNextAvailableToken() {
            if (githubTokens.length === 0) {
                return null; // No tokens available
            }
            
            // Find a token that hasn't exceeded rate limit
            for (let i = 0; i < githubTokens.length; i++) {
                const tokenIndex = (currentTokenIndex + i) % githubTokens.length;
                const token = githubTokens[tokenIndex];
                
                if (tokenCallCounts[token] < TOKEN_RATE_LIMIT) {
                    currentTokenIndex = (tokenIndex + 1) % githubTokens.length;
                    return token;
                }
            }
            
            // All tokens have exceeded rate limit, reset counts and use first available
            console.warn('All tokens have exceeded rate limit, resetting counts');
            Object.keys(tokenCallCounts).forEach(token => {
                tokenCallCounts[token] = 0;
            });
            currentTokenIndex = 0;
            return githubTokens[0];
        }
        
        function updateTokenStatus(count, statusText) {
            const tokenStatusElement = document.getElementById('tokenStatus');
            const tokenCountElement = document.getElementById('tokenCount');
            const tokenStatusTextElement = document.getElementById('tokenStatusText');
            const refreshTokensBtn = document.getElementById('refreshTokensBtn');
            const showTokenDetailsBtn = document.getElementById('showTokenDetailsBtn');
            
            if (tokenStatusElement && tokenCountElement && tokenStatusTextElement) {
                tokenCountElement.textContent = count;
                
                // Add usage information if tokens are available
                if (count > 0) {
                    const totalCalls = Object.values(tokenCallCounts).reduce((sum, count) => sum + count, 0);
                    const statusWithUsage = `${statusText} (${totalCalls} API calls made)`;
                    tokenStatusTextElement.textContent = statusWithUsage;
                } else {
                    tokenStatusTextElement.textContent = statusText;
                }
                
                tokenStatusElement.style.display = count > 0 ? 'block' : 'none';
                
                // Show buttons if tokens are available
                if (refreshTokensBtn) {
                    refreshTokensBtn.style.display = count > 0 ? 'inline-block' : 'none';
                }
                if (showTokenDetailsBtn) {
                    showTokenDetailsBtn.style.display = count > 0 ? 'inline-block' : 'none';
                }
            }
        }
        
        async function refreshTokens() {
            try {
                setStatus('Refreshing GitHub API tokens...', 'loading');
                await loadGitHubTokens();
                setStatus('GitHub API tokens refreshed successfully');
            } catch (error) {
                console.error('Error refreshing tokens:', error);
                setStatus(`Error refreshing tokens: ${error.message}`, 'error');
            }
        }
        
        function showTokenDetails() {
            if (githubTokens.length === 0) {
                alert('No tokens available');
                return;
            }
            
            let details = `GitHub API Token Details:\n\n`;
            details += `Total Tokens: ${githubTokens.length}\n`;
            details += `Current Token Index: ${currentTokenIndex}\n\n`;
            
            githubTokens.forEach((token, index) => {
                const callCount = tokenCallCounts[token] || 0;
                const remainingCalls = TOKEN_RATE_LIMIT - callCount;
                const status = callCount >= TOKEN_RATE_LIMIT ? 'RATE LIMITED' : 'ACTIVE';
                const shortToken = token.substring(0, 8) + '...';
                
                details += `Token ${index + 1}: ${shortToken}\n`;
                details += `  Calls Made: ${callCount}/${TOKEN_RATE_LIMIT}\n`;
                details += `  Remaining: ${remainingCalls}\n`;
                details += `  Status: ${status}\n\n`;
            });
            
            alert(details);
        }
        
        function parseManifest(xmlText) {
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(xmlText, 'text/xml');
            const packageElements = xmlDoc.getElementsByTagName('package');
            
            const packages = [];
            for (let pkg of packageElements) {
                packages.push({
                    name: pkg.getAttribute('name') || 'Unknown',
                    device_type: pkg.getAttribute('device_type') || '',
                    repo: pkg.getAttribute('repo') || '',
                    device: pkg.getAttribute('device') || '',
                    url: pkg.getAttribute('url') || '',
                    type: pkg.getAttribute('type') || '',
                    handler: pkg.getAttribute('handler') || ''
                });
            }
            
            return packages;
        }

        function populateDeviceTypeCombo() {
            const combo = document.getElementById('deviceType');
            const deviceTypes = [...new Set(packages.map(p => p.device_type).filter(t => t))];
            
            combo.innerHTML = '<option value="">All Types</option>';
            deviceTypes.sort().forEach(type => {
                const option = document.createElement('option');
                option.value = type;
                option.textContent = `Type ${type}`;
                combo.appendChild(option);
            });
        }

        function populateDeviceModelCombo() {
            const combo = document.getElementById('deviceModel');
            const deviceModels = [...new Set(packages.map(p => p.device).filter(m => m))];
            
            combo.innerHTML = '<option value="">All Models</option>';
            deviceModels.sort().forEach(model => {
                const option = document.createElement('option');
                option.value = model;
                option.textContent = model;
                combo.appendChild(option);
            });
        }

        function populateSoftwareCombo() {
            const combo = document.getElementById('software');
            const softwareNames = [...new Set(packages.map(p => p.name).filter(n => n))];
            
            combo.innerHTML = '<option value="">All Software</option>';
            softwareNames.sort().forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                combo.appendChild(option);
            });
        }

        function filterFirmware() {
            currentFilters.deviceType = document.getElementById('deviceType').value;
            currentFilters.deviceModel = document.getElementById('deviceModel').value;
            currentFilters.software = document.getElementById('software').value;
            
            loadFirmwareList();
        }

        async function loadFirmwareList() {
            try {
                setStatus('Loading firmware releases...', 'loading');
                
                const container = document.getElementById('firmwareContainer');
                container.innerHTML = '<div class="loading-spinner"></div> Loading...';
                
                // Get filtered packages
                const filteredPackages = packages.filter(pkg => {
                    const typeMatch = !currentFilters.deviceType || pkg.device_type === currentFilters.deviceType;
                    const modelMatch = !currentFilters.deviceModel || pkg.device === currentFilters.deviceModel;
                    const softwareMatch = !currentFilters.software || pkg.name === currentFilters.software;
                    
                    return typeMatch && modelMatch && softwareMatch;
                });
                
                if (filteredPackages.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: #6c757d;">No firmware found matching the selected filters</p>';
                    setStatus('No firmware found');
                    return;
                }
                
                // Load releases for each package
                const allReleases = [];
                for (const pkg of filteredPackages) {
                    try {
                        const releases = await getReleases(pkg.repo);
                        releases.forEach(release => {
                            release.software_name = pkg.name;
                            release.device_type = pkg.device_type;
                            release.device_model = pkg.device;
                            allReleases.push(release);
                        });
                    } catch (error) {
                        console.warn(`Failed to load releases for ${pkg.repo}:`, error);
                    }
                }
                
                // Sort releases by date (newest first)
                allReleases.sort((a, b) => new Date(b.published_at) - new Date(a.published_at));
                
                // Display releases
                displayFirmwareList(allReleases);
                setStatus(`Loaded ${allReleases.length} firmware releases`);
                
            } catch (error) {
                console.error('Error loading firmware list:', error);
                setStatus(`Error loading firmware: ${error.message}`, 'error');
                document.getElementById('firmwareContainer').innerHTML = 
                    '<p style="text-align: center; color: #c0392b;">Failed to load firmware list</p>';
            }
        }

        async function getReleases(repo) {
            try {
                const token = getNextAvailableToken();
                const headers = {};
                
                if (token) {
                    headers['Authorization'] = `Bearer ${token}`;
                    headers['Accept'] = 'application/vnd.github.v3+json';
                    
                    // Increment call count for this token
                    tokenCallCounts[token]++;
                    console.log(`Using token for ${repo} (call count: ${tokenCallCounts[token]})`);
                } else {
                    console.log(`No token available for ${repo}, using unauthenticated request`);
                }
                
                const response = await fetch(`https://api.github.com/repos/${repo}/releases`, {
                    headers: headers
                });
                
                if (!response.ok) {
                    if (response.status === 403) {
                        // Rate limit exceeded or token invalid
                        console.warn(`Rate limit or token issue for ${repo}, status: ${response.status}`);
                        if (token) {
                            // Mark this token as having issues
                            tokenCallCounts[token] = TOKEN_RATE_LIMIT;
                            console.warn(`Token ${token.substring(0, 8)}... marked as rate limited`);
                            
                            // Update token status to show the issue
                            updateTokenStatus(githubTokens.length, `${githubTokens.length} tokens loaded (some rate limited)`);
                        }
                    }
                    throw new Error(`GitHub API error: ${response.status}`);
                }
                
                const releases = await response.json();
                return releases.map(release => ({
                    tag_name: release.tag_name,
                    name: release.name || release.tag_name,
                    published_at: release.published_at,
                    html_url: release.html_url,
                    assets: release.assets || []
                }));
            } catch (error) {
                console.warn(`Failed to fetch releases for ${repo}:`, error);
                return [];
            }
        }

        function displayFirmwareList(releases) {
            const container = document.getElementById('firmwareContainer');
            
            if (releases.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #6c757d;">No releases found</p>';
                return;
            }
            
            container.innerHTML = releases.map(release => `
                <div class="firmware-item" onclick="selectFirmware(this, '${release.software_name}')">
                    <div class="firmware-name">${release.software_name}</div>
                    <div class="firmware-details">
                        <div class="detail-item">
                            <div class="detail-label">Version</div>
                            <div class="detail-value">${release.tag_name}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Name</div>
                            <div class="detail-value">${release.name}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Published</div>
                            <div class="detail-value">${formatDate(release.published_at)}</div>
                        </div>
                        ${!currentFilters.deviceType ? `<div class="detail-item">
                            <div class="detail-label">Type</div>
                            <div class="detail-value">${release.device_type || 'N/A'}</div>
                        </div>` : ''}
                        ${!currentFilters.deviceModel ? `<div class="detail-item">
                            <div class="detail-label">Model</div>
                            <div class="detail-value">${release.device_model || 'N/A'}</div>
                        </div>` : ''}
                    </div>
                    <div class="download-section">
                        <button class="download-rom-btn" onclick="downloadROM('${release.html_url}', event)">
                            📥 Download ROM
                        </button>
                        <button class="automatic-install-btn" onclick="goToInnioasisApp(event)">
                            ⚡ Automatic Install at Innioasis.app
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function selectFirmware(element, softwareName) {
            // Remove previous selection
            document.querySelectorAll('.firmware-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // Add selection to clicked item
            element.classList.add('selected');
        }

        function downloadROM(releasesUrl, event) {
            event.stopPropagation();
            
            // Open the GitHub releases page in a new tab for ROM download
            window.open(releasesUrl, '_blank');
        }

        function goToInnioasisApp(event) {
            event.stopPropagation();
            
            // Direct users to innioasis.app for automatic installation
            window.open('https://innioasis.app', '_blank');
        }

        function formatDate(dateString) {
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            } catch (error) {
                return dateString;
            }
        }

        function setStatus(message, type = '') {
            const statusElement = document.getElementById('status');
            statusElement.textContent = message;
            statusElement.className = `status ${type}`;
        }

        function refreshData() {
            loadData();
        }

        // Handle errors gracefully
        window.addEventListener('error', function(e) {
            console.error('Global error:', e.error);
            setStatus('An unexpected error occurred', 'error');
        });

        // Handle unhandled promise rejections
        window.addEventListener('unhandledrejection', function(e) {
            console.error('Unhandled promise rejection:', e.reason);
            setStatus('Network or API error occurred', 'error');
        });

        // macOS Step Navigation Functions
        function downloadMacDMG() {
            // Download macOS DMG installer
            const link = document.createElement('a');
            link.href = 'https://github.com/team-slide/Innioasis-Updater/releases/download/1.0.0/Innioasis.Updater.for.Mac.dmg';
            link.download = 'Innioasis.Updater.for.Mac.dmg';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // Show download confirmation
            setTimeout(() => {
                alert('🎉 Download started! The DMG file is downloading to your Downloads folder.');
            }, 1000);
        }

        function nextMacStep() {
            const currentStep = getCurrentMacStep();
            if (currentStep < 3) {
                hideMacStep(currentStep);
                showMacStep(currentStep + 1);
                updateAppleGuideLink();
            }
        }

        function prevMacStep() {
            const currentStep = getCurrentMacStep();
            if (currentStep > 1) {
                hideMacStep(currentStep);
                showMacStep(currentStep - 1);
            }
        }

        function getCurrentMacStep() {
            for (let i = 1; i <= 3; i++) {
                if (document.getElementById(`macStep${i}`).style.display !== 'none') {
                    return i;
                }
            }
            return 1;
        }

        function showMacStep(stepNumber) {
            document.getElementById(`macStep${stepNumber}`).style.display = 'block';
        }

        function hideMacStep(stepNumber) {
            document.getElementById(`macStep${stepNumber}`).style.display = 'none';
        }

        function updateAppleGuideLink() {
            // Get macOS version and update the Apple guide link
            const userAgent = navigator.userAgent;
            let macVersion = '14.0'; // Default to macOS 14
            
            if (userAgent.includes('Mac OS X 10_15')) {
                macVersion = '10.15'; // macOS Catalina
            } else if (userAgent.includes('Mac OS X 11_')) {
                macVersion = '11.0'; // macOS Big Sur
            } else if (userAgent.includes('Mac OS X 12_')) {
                macVersion = '14.0'; // macOS Monterey
            } else if (userAgent.includes('Mac OS X 13_')) {
                macVersion = '14.0'; // macOS Ventura
            } else if (userAgent.includes('Mac OS X 14_')) {
                macVersion = '14.0'; // macOS Sonoma
            } else if (userAgent.includes('Mac OS X 15_')) {
                macVersion = '15.0'; // macOS Sequoia
            }
            
            const appleGuideLink = document.getElementById('appleGuideLink');
            if (appleGuideLink) {
                appleGuideLink.href = `https://support.apple.com/en-gb/guide/mac-help/mh40616/${macVersion}/mac/${macVersion}`;
            }
        }

        function showMacTerminalInstall() {
            // Show terminal installation method
            const terminalDialog = document.createElement('div');
            terminalDialog.className = 'platform-dialog show';
            terminalDialog.innerHTML = `
                <h3>🍎 Terminal Installation</h3>
                <p>For advanced users, you can install via Terminal:</p>
                <div class="command-display">
                    <code>curl -fsSL https://raw.githubusercontent.com/team-slide/Innioasis-Updater/refs/heads/main/run_mac.sh | bash</code>
                </div>
                <button class="btn" onclick="copyMacCommand()">📋 Copy Command</button>
                <button class="btn btn-secondary" onclick="closeTerminalDialog()">Close</button>
            `;
            
            document.body.appendChild(terminalDialog);
            document.getElementById('dialogOverlay').classList.add('show');
        }

        function closeTerminalDialog() {
            const terminalDialog = document.querySelector('.platform-dialog.show:not(#macDialog)');
            if (terminalDialog) {
                terminalDialog.remove();
            }
            document.getElementById('dialogOverlay').classList.remove('show');
        }
    </script>
</body>
</html>
